=# TODO: Deal with pagination. This seems like a good place to handle "Add page."
- next_page = nil unless defined?(next_page)
- previous_page = nil unless defined?(previous_page)
%div{:class => ["content", @page.theme]}
  .page-nav
    - if previous_page
      - if @offering
        %a{:class => 'previous', :href => activity_page_offering_show_path(@activity, previous_page, @offering)}
          ! &nbsp;
      -else
        %a{:class => 'previous', :href => activity_page_path(@activity, previous_page)}
          ! &nbsp;
    - else
      %a{:class => 'previous disabled'}
        ! &nbsp;
    - page_counter = 1
    - @activity.pages.each do |p|
      - if @offering
      = link_to page_counter, activity_page_offering_show_path(@activity, p, @offering), :class => (p === page) ? 'active' : ''
      - else
        = link_to page_counter, activity_page_path(p.lightweight_activity, p), :class => (p === @page) ? 'active' : ''
      - page_counter = page_counter + 1
    - if next_page
      - if @offering
        %a{:class => 'next', :href => activity_page_offering_show_path(@activity, next_page, @offering)}
          ! &nbsp;
      -else
        %a{:class => 'next', :href => activity_page_path(@activity, next_page)}
          ! &nbsp;
    - else
      = link_to '+', new_activity_page_path(@activity), {:title => "Add another page to #{@activity.name}", :class => 'next'}

  %h1.title
    = @activity.name
  %p.question
    Editing
    = in_place_editor_field @page, 'name'
  = form_for @page, {:url => "/lightweight/activities/#{@activity.id}/pages/#{@page.id}", :method => 'put'} do |f|
    = f.error_messages
    = edit_menu_for(@page, f)
    = field_set_tag 'Page Appearance' do
      = f.text_field :theme
    .text
      -# TODO: How do we make this show up if there's no text yet for the field?
      %p.instructions= in_place_editor_field @page, 'text'
      .questions
        - @page.embeddables.each do |e|
          - e_type = e.class.name.underscore
          = render :partial => "#{e_type}/lightweight", :locals => {:embeddable => e}
    .other
      - @page.interactives.each do |interactive|
        - i_type = interactive.class.name.underscore
        = render :partial => "#{i_type}/show", :locals => {:interactive => interactive}
      = link_to "Add interactive", new_page_mw_interactive_path(@page)
    .sidebar
      -# TODO: How do we make this show up if there's no text yet for the field?
      = in_place_editor_field @page, 'sidebar'
    - if @page.interactives
      #embed
      #share

  = javascript_tag("focus_first_field();");

  %ul.tasks
    %li= link_to "See this page", activity_page_path(@activity, @page)
    %li= link_to "Return to editing #{@activity.name}", edit_activity_path(@activity)
    %li= link_to "Add another page to #{@activity.name}", new_activity_page_path(@activity) 